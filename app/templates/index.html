<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header class="site-header">
    <div class="wrap nav">
      <div class="brand">SecureMail</div>
      <nav class="nav-links">
        <a href="#classifier" data-scroll>Test</a>
        <a href="#how-it-works" data-scroll>How it Works</a>
        <a href="#spam-phishing" data-scroll>Spam & Phishing</a>
        <a href="#performance" data-scroll>Performance</a>
        <a href="#impact" data-scroll>Business Impact</a>
        <a href="#learning" data-scroll>Learning Hub</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="wrap hero-inner">
      <h1>Smarter Email Security with AI</h1>
      <p class="sub">SecureMail’s ML-based spam classifier helps enterprises reduce phishing risk and keep communication clean.</p>
      <div class="cta">
        <a class="btn primary" href="#classifier" data-scroll>Test the Classifier</a>
        <a class="btn ghost" href="#how-it-works" data-scroll>Learn How It Works</a>
      </div>
    </div>
    <div class="glow"></div>
  </section>

  <main class="wrap">

    <!-- Test the Classifier -->
    <section id="classifier" class="section card">
      <div class="section-head">
        <h2>Spam Detector</h2>
        <p class="muted">Paste a message and see the classification instantly.</p>
      </div>
      <div class="grid-2">
        <div>
          <label class="label">Message</label>
          <textarea id="text" placeholder="Type or paste your email text..."></textarea>
          <div class="row">
            <button id="predict-btn" class="btn primary">Analyze</button>
            <button id="clear-btn" class="btn ghost" type="button">Clear</button>
          </div>
        </div>
        <div>
          <div id="result" class="result-card hidden">
            <div id="badge" class="badge">Result</div>
            <div class="result-copy" id="result-copy">Your result will appear here.</div>
          </div>
          <div class="note muted tiny">No probabilities or feature attributions are shown; this demo focuses on clarity and privacy.</div>
        </div>
      </div>
    </section>

    <!-- How It Works -->
    <section id="how-it-works" class="section card">
      <div class="section-head">
        <h2>How Our Classifier Works</h2>
        <p class="muted">A simple end-to-end pipeline with modern NLP.</p>
      </div>

      <!-- Step diagram (SVG) -->
      <div class="steps">
        <div class="step">
          <div class="step-title" data-tip="Removing noise, normalizing case, stripping markup.">Data Preprocessing</div>
          <div class="step-sub">Cleaning, tokenization</div>
        </div>
        <div class="arrow">→</div>
        <div class="step">
          <div class="step-title" data-tip="Turning text into numeric vectors.">Feature Extraction</div>
          <div class="step-sub">TF-IDF n-grams / embeddings</div>
        </div>
        <div class="arrow">→</div>
        <div class="step">
          <div class="step-title" data-tip="Training with labeled data.">Model Training</div>
          <div class="step-sub">Scikit-learn / Transformers</div>
        </div>
        <div class="arrow">→</div>
        <div class="step">
          <div class="step-title" data-tip="Serve the trained pipeline via API.">Prediction</div>
          <div class="step-sub">Real-time classification</div>
        </div>
      </div>

      <div class="tips-inline">
        <span class="chip" data-tip="Natural Language Processing">NLP</span>
        <span class="chip" data-tip="True positive rate over predicted positives">Precision</span>
        <span class="chip" data-tip="True positive rate over actual positives">Recall</span>
        <span class="chip" data-tip="Harmonic mean of precision &amp; recall">F1 Score</span>
      </div>
    </section>

    <!-- What is Spam & Phishing -->
    <section id="spam-phishing" class="section card">
      <div class="section-head">
        <h2>What is Spam & Phishing?</h2>
        <p class="muted">Recognize common tactics and stay safe.</p>
      </div>
      <div class="grid-3">
        <div class="tile">
          <h3>Spam</h3>
          <p>Unsolicited bulk messages (ads, promos). Often low-effort and generic.</p>
        </div>
        <div class="tile">
          <h3>Phishing</h3>
          <p>Deceptive emails that impersonate trusted brands to steal credentials or money.</p>
        </div>
        <div class="tile">
          <h3>Tactics</h3>
          <ul class="list">
            <li>Urgency & fear</li>
            <li>Fake invoices / payroll updates</li>
            <li>Look-alike domains & links</li>
          </ul>
        </div>
      </div>
      <div class="do-donts">
        <div>
          <h4>How to Spot Suspicious Emails</h4>
          <ul class="list">
            <li>Verify the sender domain carefully</li>
            <li>Hover links before clicking</li>
            <li>Be skeptical of “immediate action required”</li>
            <li>Don’t share credentials over email</li>
          </ul>
        </div>
        <div class="callout">
          Report suspicious messages to your security team and use your mail provider’s “Report spam” button to improve filters.
        </div>
      </div>
    </section>

    <!-- Performance & Evaluation -->
    <section id="performance" class="section card">
      <div class="section-head">
        <h2>Performance & Evaluation</h2>
        <p class="muted">Key metrics from our evaluation suite.</p>
      </div>
      <div id="metric-cards" class="grid-4">
        <!-- Filled by JS from /metrics -->
        <div class="metric"><div class="kpi" id="kpi-accuracy">—</div><div class="kpi-label">Accuracy</div></div>
        <div class="metric"><div class="kpi" id="kpi-precision">—</div><div class="kpi-label">Precision</div></div>
        <div class="metric"><div class="kpi" id="kpi-recall">—</div><div class="kpi-label">Recall</div></div>
        <div class="metric"><div class="kpi" id="kpi-f1">—</div><div class="kpi-label">F1 Score</div></div>
      </div>
      <div class="grid-2">
        <div class="panel">
          <h4>PR-AUC & ROC-AUC</h4>
          <div class="pair">
            <div><span class="tag">PR-AUC</span> <span id="val-prauc">—</span></div>
            <div><span class="tag">ROC-AUC</span> <span id="val-rocauc">—</span></div>
          </div>
          <p class="muted tiny">These summarize ranking quality; higher is better. Values appear if recorded during training.</p>
        </div>
        <div class="panel">
          <h4>Confusion Matrix</h4>
          <div class="cm">
            <div class="cm-row">
              <div class="cm-cell head"></div><div class="cm-cell head">Pred: Ham</div><div class="cm-cell head">Pred: Spam</div>
            </div>
            <div class="cm-row">
              <div class="cm-cell head">Actual Ham</div><div class="cm-cell" id="cm-tn">—</div><div class="cm-cell" id="cm-fp">—</div>
            </div>
            <div class="cm-row">
              <div class="cm-cell head">Actual Spam</div><div class="cm-cell" id="cm-fn">—</div><div class="cm-cell" id="cm-tp">—</div>
            </div>
          </div>
          <p class="muted tiny">False positives vs. false negatives matter differently by business context.</p>
        </div>
      </div>
    </section>

    <!-- Business Impact -->
    <section id="impact" class="section card">
      <div class="section-head">
        <h2>Business Impact</h2>
        <p class="muted">How SecureMail improves organizational trust and productivity.</p>
      </div>
      <div class="grid-3">
        <div class="tile">
          <h3>Reduced Risk</h3>
          <p>Fewer phishing attempts reach inboxes, lowering breach probability.</p>
        </div>
        <div class="tile">
          <h3>Time Saved</h3>
          <p>Automated filtering reduces triage time for IT and employees.</p>
        </div>
        <div class="tile">
          <h3>Trust & Compliance</h3>
          <p>Clear controls and reporting reinforce security culture and audit readiness.</p>
        </div>
      </div>
    </section>

    <!-- Learning Hub -->
    <section id="learning" class="section card">
      <div class="section-head">
        <h2>Insights & Cybersecurity Learning Hub</h2>
        <p class="muted">Stay ahead with practical guidance and trends.</p>
      </div>
      <div class="grid-3">
        <div class="tile">
          <h3>Trends in Phishing</h3>
          <p>New lures evolve monthly—train models and staff regularly.</p>
        </div>
        <div class="tile">
          <h3>ML for Email Security</h3>
          <p>From TF-IDF to transformer embeddings: when to use which.</p>
        </div>
        <div class="tile">
          <h3>Cyber Hygiene</h3>
          <p>Strong passwords, MFA, and least-privilege access are still king.</p>
        </div>
      </div>
    </section>

  </main>

  <footer class="site-footer">
    <div class="wrap">
      <div class="foot">© SecureMail • v2.0 — Educational demo. Verify sensitive decisions.</div>
    </div>
  </footer>

  <script>
    // Smooth scroll
    document.querySelectorAll('[data-scroll]').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        document.querySelector(a.getAttribute('href')).scrollIntoView({behavior: 'smooth', block: 'start'});
      });
    });

    // Tooltips (data-tip attribute)
    document.querySelectorAll('[data-tip]').forEach(el => {
      el.addEventListener('mouseenter', () => { el.setAttribute('data-show', '1'); });
      el.addEventListener('mouseleave', () => { el.removeAttribute('data-show'); });
    });

    // Classifier call
    const btn = document.getElementById('predict-btn');
    const clearBtn = document.getElementById('clear-btn');
    const textEl = document.getElementById('text');
    const result = document.getElementById('result');
    const badge = document.getElementById('badge');
    const resultCopy = document.getElementById('result-copy');

    btn.addEventListener('click', async () => {
      const text = textEl.value.trim();
      if (!text) return;
      const res = await fetch('/predict', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({text})
      });
      const data = await res.json();
      result.classList.remove('hidden');
      badge.textContent = data.label;
      badge.className = 'badge ' + (data.prediction === 1 ? 'spam' : 'ham');
      resultCopy.textContent = (data.prediction === 1)
        ? 'This message resembles known spam patterns.'
        : 'This message does not resemble spam patterns.';
    });

    clearBtn.addEventListener('click', () => {
      textEl.value = '';
      result.classList.add('hidden');
      badge.className = 'badge';
      badge.textContent = 'Result';
      resultCopy.textContent = 'Your result will appear here.';
    });

    // Load metrics into cards if available
    fetch('/metrics').then(r => r.json()).then(m => {
      const set = (id, val) => { const el = document.getElementById(id); if (el && val != null) el.textContent = (typeof val === 'number') ? (val.toFixed(3)) : val; };
      set('val-prauc', m.pr_auc);
      set('val-rocauc', m.roc_auc);

      // Optional fields if you add them to metadata.json during training
      set('kpi-accuracy', m.accuracy ?? '—');
      set('kpi-precision', m.precision ?? '—');
      set('kpi-recall', m.recall ?? '—');
      set('kpi-f1', m.f1 ?? '—');

      // Optional confusion matrix
      if (m.confusion_matrix && Array.isArray(m.confusion_matrix)) {
        // Expect [[tn, fp],[fn, tp]] or similar — try to place safely
        const flat = m.confusion_matrix.flat();
        if (flat.length >= 4) {
          document.getElementById('cm-tn').textContent = flat[0];
          document.getElementById('cm-fp').textContent = flat[1];
          document.getElementById('cm-fn').textContent = flat[2];
          document.getElementById('cm-tp').textContent = flat[3];
        }
      }
    }).catch(() => {});
  </script>
</body>
</html>
